{% extends 'layouts/content/members-area.html.twig' %}

{% block title %}{{ 'Participants'|trans }} | {{ parent() }}{% endblock %}

{% block main %}
	<h1>
		{{ 'Participants'|trans }}
		<a class="btn btn-primary btn-sm"
			href="{{ url('members-area.participants.new') }}">
			{{ 'New'|trans }}
		</a>
	</h1>
	<ol class="breadcrumb">
		<li>
			<a href="{{ url('members-area') }}">
				{{ 'Home' | trans }}
			</a>
		</li>
		<li class="active">
			{{ 'Participants' | trans }}
		</li>
	</ol>
	<div class="table-responsive">
		<table class="table table-striped table-condensed">
			<thead>
				<tr>
					<th>{{ paginator_sortable(pagination, 'Name', 'p.name') }}</th>
					<th>{{ paginator_sortable(pagination, 'Email', 'p.email') }}</th>
					<th>{{ paginator_sortable(pagination, 'Via', 'p.via') }}</th>
					<th>{{ 'Metas' | trans }}</th>
					<th>{{ paginator_sortable(pagination, 'IP', 'p.ip') }}</th>
					<th>{{ paginator_sortable(pagination, 'User Agent', 'p.userAgent') }}</th>
					<th width="160">{{ paginator_sortable(pagination, 'Time Created', 'p.timeCreated') }}</th>
					<th width="100">{{ 'Actions' | trans }}</th>
				</tr>
			</thead>
			<tbody>
				{% for participant in pagination.getItems() %}
					<tr>
						<td>{{ participant.getName() }}</td>
						<td>{{ participant.getEmail() }}</td>
						<td>{{ participant.getVia() }}</td>
						<td>
							{% set participantMetas = participant.getParticipantMetas() %}
							{% if participantMetas %}
								<ul>
									{% for participantMeta in participantMetas %}
										<li>{{ participantMeta }}</li>
									{% endfor %}
								</ul>
							{% endif %}
						</td>
						<td>
							{% set participantIp = participant.getIp() %}
							{% if participantIp %}
								{% set ipParserInfo = app['ip.parser'].parse( participantIp ) %}
								<ul class="list-unstyled">
									<li>
										<b>{{ 'IP' | trans }}:</b>
										{{ participantIp }}
									</li>
									{% if ipParserInfo.geoplugin_city is defined and ipParserInfo.geoplugin_city %}
										<li>
											<b>{{ 'City' | trans }}:</b>
											{{ ipParserInfo.geoplugin_city }}
										</li>
									{% endif %}
									{% if ipParserInfo.geoplugin_region is defined and ipParserInfo.geoplugin_region %}
										<li>
											<b>{{ 'Region' | trans }}:</b>
											{{ ipParserInfo.geoplugin_region }}
										</li>
									{% endif %}
									{% if ipParserInfo.geoplugin_countryCode is defined and ipParserInfo.geoplugin_countryCode %}
										<li>
											<b>{{ 'Country' | trans }}:</b>
											{{ ipParserInfo.geoplugin_countryCode }} /
											{{ ipParserInfo.geoplugin_countryName }}
										</li>
									{% endif %}
									{% if ipParserInfo.geoplugin_continentCode is defined and ipParserInfo.geoplugin_continentCode %}
										<li>
											<b>{{ 'Country' | trans }}:</b>
											{{ ipParserInfo.geoplugin_continentCode }}
										</li>
									{% endif %}
								</ul>
							{% endif %}
						</td>
						<td>
							{% set participantUserAgent = participant.getUserAgent() %}
							{% if participantUserAgent %}
								{% set uaParserInfo = app['ua.parser'].parse( participantUserAgent ) %}
								<ul class="list-unstyled">
									<li class="hidden">
										<b>{{ 'User Agent' | trans }}:</b>
										{{ participant.getUserAgent() }}
									</li>
									<li>
										<b>{{ 'Browser' | trans }}:</b>
										{{ uaParserInfo.ua }}
									</li>
									<li>
										<b>{{ 'Operating system' | trans }}:</b>
										{{ uaParserInfo.os }}
									</li>
									<li>
										<b>{{ 'Device' | trans }}:</b>
										{{ uaParserInfo.device }}
									</li>
								</ul>
							{% endif %}
						</td>
						<td>{{ participant.getTimeCreated()|date(app.dateTimeFormat) }}</td>
						<td>
							<a class="btn btn-sm btn-default margin-bottom"
								data-toggle="tooltip" title="{{ 'Edit'|trans }}"
								href="{{ url('members-area.participants.edit', { id : participant.getId() }) }}">
								<i class="fa fa-fw fa-cog"></i>
							</a>
							<a class="btn btn-sm btn-default margin-bottom"
								data-toggle="tooltip" title="{{ 'Remove'|trans }}"
								href="{{ url('members-area.participants.remove', { id : participant.getId() }) }}">
								<i class="fa fa-fw fa-times"></i>
							</a>
						</td>
					</tr>
				{% else %}
					<tr>
						<td colspan="99">{{ 'No participants yet'|trans }}</td>
					</tr>
				{% endfor %}
			</tbody>
		</table>
		{{ paginator_render(pagination) }}
	</div>
	<p>
		Some of the returned data includes GeoLite data created by MaxMind,
		available from <a href="http://www.maxmind.com">http://www.maxmind.com</a>.
	</p>
{% endblock %}
